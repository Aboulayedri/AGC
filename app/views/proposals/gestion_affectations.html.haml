.page-header
  %h1 
    Gestion des affectations
    = Time.now.next_week.strftime("S%W %Y")
%h2 Les consultants sortants
%table.table.table-striped
  %thead
    %tr
      %th Consultant
      %th Dernier projet
  %tbody
    - @propositions_sortantes.each do |proposal|
      %tr
        %td= link_to proposal.consultant.name, "#modal"+proposal.consultant_id.to_s, "data-toggle" => 'modal'
        %td= proposal.project.name

%h2 Les consultants disponibles
%table.table.table-striped
  %thead
    %tr
      %th Consultant
      %th Nombre de jours
      %th Entité
      %th Actions
  %tbody
    - @propositions_disponibles.each do |proposal|
      %tr
        %td= link_to proposal.consultant.name, "#modal"+proposal.consultant_id.to_s, "data-toggle" => 'modal'
        %td= proposal.nbre_jour
        %td= proposal.consultant.entity.name
        %td
          =# link_to "Consulter", proposal, :class => 'btn btn-mini'
          =# link_to "Reserver", reserver_proposal_path(proposal), :class => 'btn btn-mini'
          = link_to "Reserver", "#proposition"+proposal.id.to_s, class: 'btn btn-mini', "data-toggle" => "modal"

%h2 Les consultants reservés
%table.table.table-striped
  %thead
    %tr
      %th Consultant
      %th Projet
      %th Nombre de jours
      %th Entité
      %th Actions
  %tbody
    - @propositions_reservees.each do |proposal|
      %tr
        %td= link_to proposal.consultant.name, "#modal"+proposal.consultant_id.to_s, "data-toggle" => 'modal'
        %td= proposal.project.name
        %td= proposal.nbre_jour
        %td= proposal.consultant.entity.name
        %td
          =# link_to "Consulter", proposal, :class => 'btn btn-mini'
          = link_to "Liberer", liberer_proposal_path(proposal), :class => 'btn btn-mini'
          = link_to "Valider", valider_proposal_path(proposal), :class => 'btn btn-mini'

- @propositions_sortantes.each do |proposal|
  - dialog_body = capture do
    %p
      %strong Niveau de diplôme :
      = proposal.consultant.niv_diplome
    %p
      %strong Nature du diplôme :
      = proposal.consultant.nat_diplome
    %p
      %strong Entité :
      = proposal.consultant.entity.name
  = modal_dialog id: "modal"+proposal.consultant_id.to_s,
  header: { title: proposal.consultant.name },
  body: dialog_body,
  footer: content_tag(:button, 'Fermer', class: 'btn', "data-dismiss" => "modal")

- @propositions_disponibles.each do |proposal|
  - dialog_body = capture do
    %p
      %strong Niveau de diplôme :
      = proposal.consultant.niv_diplome
    %p
      %strong Nature du diplôme :
      = proposal.consultant.nat_diplome
    %p
      %strong Entité :
      = proposal.consultant.entity.name
  = modal_dialog id: "modal"+proposal.consultant_id.to_s,
  header: { title: proposal.consultant.name },
  body: dialog_body,
  footer: content_tag(:button, 'Fermer', class: 'btn', "data-dismiss" => "modal")

- @propositions_reservees.each do |proposal|
  - dialog_body = capture do
    %p
      %strong Niveau de diplôme :
      = proposal.consultant.niv_diplome
    %p
      %strong Nature du diplôme :
      = proposal.consultant.nat_diplome
    %p
      %strong Entité :
      = proposal.consultant.entity.name
  = modal_dialog id: "modal"+proposal.consultant_id.to_s,
  header: { title: proposal.consultant.name },
  body: dialog_body,
  footer: content_tag(:button, 'Fermer', class: 'btn', "data-dismiss" => "modal")

- @propositions_disponibles.each do |proposal|
  - dialog_body = capture do
    = simple_form_for proposal, :html => { class: 'form-horizontal' } do |f|
      = f.input :etat, as: :hidden, input_html: { value: "reservée" }
      = f.association :project, label: "Projet"
      .form-actions
        = f.button :submit, label: "Valider", class: 'btn-primary'
        = #link_to "Annuler", proposals_path, :class => 'btn'
  = modal_dialog id: "proposition"+proposal.id.to_s,
  header: { title: "Réservation de : "+ proposal.consultant.name },
  body: dialog_body,
  footer: content_tag(:button, 'Fermer', class: 'btn', "data-dismiss" => "modal")
